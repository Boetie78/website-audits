<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Interactive Elements - Promac Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-center">Interactive Elements Test - Promac Report</h1>
        
        <div class="bg-white p-6 rounded-lg shadow-lg mb-6">
            <h2 class="text-xl font-semibold mb-4">Test All Interactive Functions</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <!-- Dropdown Test -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-semibold mb-3">üîΩ Dropdown Functions</h3>
                    <button onclick="testToggleAdvantageDetails()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mb-2 w-full">
                        Test toggleAdvantageDetails()
                    </button>
                    <div class="text-sm text-gray-600">Tests dropdown visibility toggle</div>
                </div>
                
                <!-- Export Test -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-semibold mb-3">üì§ Export Functions</h3>
                    <button onclick="testExportCSV()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 mb-2 w-full">
                        Test exportCSV()
                    </button>
                    <button onclick="testExportCompetitorCSV()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 mb-2 w-full">
                        Test exportCompetitorCSV()
                    </button>
                    <div class="text-sm text-gray-600">Tests CSV export functionality</div>
                </div>
                
                <!-- Toggle Test -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-semibold mb-3">üîÑ Toggle Functions</h3>
                    <button onclick="testToggleView()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 mb-2 w-full">
                        Test toggleView()
                    </button>
                    <button onclick="testToggleCompetitorView()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 mb-2 w-full">
                        Test toggleCompetitorView()
                    </button>
                    <div class="text-sm text-gray-600">Tests content visibility toggles</div>
                </div>
                
                <!-- Global Access Test -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-semibold mb-3">üåê Global Function Access</h3>
                    <button onclick="testAllFunctionAccess()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 mb-2 w-full">
                        Test All Function Access
                    </button>
                    <div class="text-sm text-gray-600">Verifies functions are globally accessible</div>
                </div>
            </div>
            
            <div id="testResults" class="p-4 bg-gray-100 rounded-lg">
                <h3 class="font-semibold mb-2">Test Results:</h3>
                <div id="results"></div>
            </div>
        </div>
        
        <!-- Mock elements for testing -->
        <div class="bg-white p-6 rounded-lg shadow-lg" style="display: none;">
            <div id="niche-dominance-details" class="hidden">Test dropdown content</div>
            <div id="brand-authority-details" class="hidden">Test dropdown content</div>
            <button id="nicheDominanceBtn"><svg class="arrow"></svg>View Detailed Rankings</button>
            <button id="brandAuthorityBtn"><svg class="arrow"></svg>View Authority Breakdown</button>
            
            <table id="metadataTable">
                <thead><tr><th>URL</th><th>Title</th><th>Description</th></tr></thead>
                <tbody><tr><td>/</td><td>Test</td><td>Test desc</td></tr></tbody>
            </table>
            
            <div class="competitor-keyword hidden" data-competitor="dulux">Test keyword 1</div>
            <div class="competitor-keyword hidden" data-competitor="dulux">Test keyword 2</div>
            <button id="duluxToggleBtn">Show All Rankings</button>
        </div>
    </div>

    <!-- Include the main report JavaScript functions -->
    <script>
        // Copy of the interactive functions from promac-report-rebuild.html
        // These should be globally accessible
        
        function exportCSV(sectionName) {
            console.log('exportCSV called with:', sectionName);
            let csvContent = 'test,data\n1,2\n';
            let filename = 'test.csv';
            
            // Create and download the CSV file (simplified for testing)
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            return 'CSV export successful';
        }

        function exportCompetitorCSV(competitorName) {
            console.log('exportCompetitorCSV called with:', competitorName);
            let csvContent = 'competitor,data\n' + competitorName + ',test\n';
            let filename = competitorName.toLowerCase() + '-test.csv';
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            return 'Competitor CSV export successful';
        }

        function toggleAdvantageDetails(section) {
            console.log('toggleAdvantageDetails called with:', section);
            const detailsDiv = document.getElementById(section + '-details');
            const button = document.getElementById(section === 'niche-dominance' ? 'nicheDominanceBtn' : 'brandAuthorityBtn');
            
            if (detailsDiv && button) {
                if (detailsDiv.classList.contains('hidden')) {
                    detailsDiv.classList.remove('hidden');
                    return 'Details shown';
                } else {
                    detailsDiv.classList.add('hidden'); 
                    return 'Details hidden';
                }
            }
            return 'Elements not found';
        }

        function toggleView(sectionName) {
            console.log('toggleView called with:', sectionName);
            return 'Toggle view successful';
        }

        function toggleCompetitorView(competitor) {
            console.log('toggleCompetitorView called with:', competitor);
            const hiddenKeywords = document.querySelectorAll(`.competitor-keyword[data-competitor="${competitor}"].hidden`);
            const toggleBtn = document.getElementById(`${competitor}ToggleBtn`);
            
            if (hiddenKeywords.length > 0 && hiddenKeywords[0].classList.contains('hidden')) {
                hiddenKeywords.forEach(keyword => {
                    keyword.classList.remove('hidden');
                });
                if (toggleBtn) toggleBtn.textContent = 'Show Top 5';
                return 'Keywords shown';
            } else {
                const allKeywords = document.querySelectorAll(`.competitor-keyword[data-competitor="${competitor}"]`);
                allKeywords.forEach((keyword, index) => {
                    if (index > 0) keyword.classList.add('hidden');
                });
                if (toggleBtn) toggleBtn.textContent = 'Show All Rankings';
                return 'Keywords hidden';
            }
        }

        // Test functions
        function addResult(test, status, message) {
            const results = document.getElementById('results');
            const result = document.createElement('div');
            result.className = `p-2 mb-2 rounded ${status === 'PASS' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`;
            result.innerHTML = `<strong>${test}:</strong> ${status} - ${message}`;
            results.appendChild(result);
        }

        function testToggleAdvantageDetails() {
            try {
                const result1 = toggleAdvantageDetails('niche-dominance');
                const result2 = toggleAdvantageDetails('brand-authority');
                addResult('toggleAdvantageDetails', 'PASS', `Function works: ${result1}, ${result2}`);
            } catch (error) {
                addResult('toggleAdvantageDetails', 'FAIL', error.message);
            }
        }

        function testExportCSV() {
            try {
                const result = exportCSV('Metadata Analysis');
                addResult('exportCSV', 'PASS', 'CSV export function works - file should download');
            } catch (error) {
                addResult('exportCSV', 'FAIL', error.message);
            }
        }

        function testExportCompetitorCSV() {
            try {
                const result = exportCompetitorCSV('Dulux');
                addResult('exportCompetitorCSV', 'PASS', 'Competitor CSV export works - file should download');
            } catch (error) {
                addResult('exportCompetitorCSV', 'FAIL', error.message);
            }
        }

        function testToggleView() {
            try {
                const result = toggleView('Metadata Analysis');
                addResult('toggleView', 'PASS', 'Toggle view function accessible and working');
            } catch (error) {
                addResult('toggleView', 'FAIL', error.message);
            }
        }

        function testToggleCompetitorView() {
            try {
                const result = toggleCompetitorView('dulux');
                addResult('toggleCompetitorView', 'PASS', `Function works: ${result}`);
            } catch (error) {
                addResult('toggleCompetitorView', 'FAIL', error.message);
            }
        }

        function testAllFunctionAccess() {
            const functions = [
                'exportCSV',
                'exportCompetitorCSV', 
                'toggleAdvantageDetails',
                'toggleView',
                'toggleCompetitorView'
            ];
            
            let allAccessible = true;
            const results = [];
            
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    results.push(`‚úÖ ${funcName}`);
                } else {
                    results.push(`‚ùå ${funcName}`);
                    allAccessible = false;
                }
            });
            
            addResult('Global Function Access', 
                allAccessible ? 'PASS' : 'FAIL', 
                results.join(', '));
        }

        // Auto-run tests on page load
        window.addEventListener('load', function() {
            setTimeout(() => {
                addResult('Page Load', 'PASS', 'Test page loaded successfully');
                testAllFunctionAccess();
            }, 1000);
        });
    </script>
</body>
</html>