<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Fully Automated SEO Audit System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="mcp-development-fallback.js"></script>
    <script src="real-mcp-data-collector.js"></script>
    <script src="automated-seo-audit-system.js"></script>
    <style>
        .csv-embedded-table {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .csv-embedded-table table {
            width: 100%;
            border-collapse: collapse;
        }
        .csv-embedded-table th, .csv-embedded-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        .csv-embedded-table th {
            background-color: #e9ecef;
            font-weight: bold;
        }
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
            font-size: 12px;
        }
        .badge.critical { background-color: #dc3545; }
        .badge.high { background-color: #fd7e14; }
        .badge.medium { background-color: #ffc107; color: black; }
        .main-customer { background-color: #e3f2fd !important; }
        .checklist-item {
            padding: 8px 16px;
            margin: 4px 0;
            border-radius: 6px;
            border-left: 4px solid #6c757d;
        }
        .checklist-item.pending { border-left-color: #6c757d; background: #f8f9fa; }
        .checklist-item.in-progress { border-left-color: #ffc107; background: #fff3cd; }
        .checklist-item.completed { border-left-color: #28a745; background: #d4edda; }
        .checklist-item.failed { border-left-color: #dc3545; background: #f8d7da; }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-4xl font-bold text-gray-900 mb-8">üöÄ Fully Automated SEO Audit System</h1>
        <p class="text-gray-600 mb-8">Single-click automation: Create folder ‚Üí Collect data ‚Üí Generate report with embedded CSV analysis</p>

        <!-- Customer Input Section -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">1. Customer Information</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Company Name</label>
                    <input type="text" id="companyName" class="mt-1 block w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="e.g., Smith & Associates">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Website URL</label>
                    <input type="text" id="website" class="mt-1 block w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="e.g., smithassociates.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Industry</label>
                    <input type="text" id="industry" class="mt-1 block w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="e.g., Legal Services">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="email" class="mt-1 block w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="contact@smithassociates.com">
                </div>
            </div>
        </div>

        <!-- Competitor URLs Section -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">2. Competitor Analysis (Optional)</h2>
            <div class="space-y-3">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Competitor 1 URL</label>
                    <input type="text" id="competitor1" class="mt-1 block w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="https://competitor1.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Competitor 2 URL</label>
                    <input type="text" id="competitor2" class="mt-1 block w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="https://competitor2.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Competitor 3 URL</label>
                    <input type="text" id="competitor3" class="mt-1 block w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="https://competitor3.com">
                </div>
            </div>
        </div>

        <!-- Single-Click Automation Button -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">3. Fully Automated Audit Execution</h2>
            <p class="text-gray-600 mb-4">Click once to execute the complete workflow: folder creation ‚Üí data collection ‚Üí analysis ‚Üí report generation</p>
            <button onclick="executeFullyAutomatedAudit()" class="bg-green-600 text-white px-8 py-4 rounded-lg hover:bg-green-700 font-semibold text-lg">
                üöÄ Execute Fully Automated Audit
            </button>
        </div>

        <!-- Real-Time Checklist Progress -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">4. Automated Checklist Progress</h2>
            <div id="checklistProgress" class="space-y-2">
                <p class="text-gray-500">Checklist will appear when audit starts...</p>
            </div>
        </div>

        <!-- Embedded Report Results -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">5. Automated Report with Embedded CSV Data</h2>
            <div id="embeddedReport">
                <p class="text-gray-500">Report will be generated automatically with all CSV data embedded...</p>
            </div>
        </div>
    </div>

    <script>
        let automatedAuditSystem = null;

        // Initialize the automated audit system
        window.addEventListener('load', function() {
            if (window.AutomatedSEOAuditSystem) {
                automatedAuditSystem = new window.AutomatedSEOAuditSystem();
                console.log('‚úÖ Automated SEO Audit System initialized');
            } else {
                console.error('‚ùå AutomatedSEOAuditSystem not found');
            }
        });

        async function executeFullyAutomatedAudit() {
            if (!automatedAuditSystem) {
                alert('System not initialized. Please refresh the page.');
                return;
            }

            // Get customer data
            const customerData = {
                companyName: document.getElementById('companyName').value,
                website: document.getElementById('website').value,
                industry: document.getElementById('industry').value,
                email: document.getElementById('email').value,
                id: Date.now().toString()
            };

            // Validate required fields
            if (!customerData.companyName || !customerData.website) {
                alert('Please fill in at least Company Name and Website URL');
                return;
            }

            // Get competitor URLs
            const competitorUrls = [
                document.getElementById('competitor1').value,
                document.getElementById('competitor2').value,
                document.getElementById('competitor3').value
            ].filter(url => url.trim() !== '');

            console.log('üöÄ Starting FULLY AUTOMATED audit for:', customerData.companyName);
            console.log('üéØ Competitors:', competitorUrls);

            try {
                // Start the fully automated audit
                const result = await automatedAuditSystem.executeCompleteAutomatedAudit(customerData, competitorUrls);

                // The system will automatically update the checklist and report during execution
                console.log('‚úÖ Fully automated audit completed successfully!', result);

            } catch (error) {
                console.error('‚ùå Fully automated audit failed:', error);
                document.getElementById('embeddedReport').innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                        <h3 class="font-semibold text-red-800">‚ùå Audit Failed</h3>
                        <p class="text-red-600 mt-2">Error: ${error.message}</p>
                        <p class="text-red-600">Check the console for detailed error information</p>
                    </div>
                `;
            }
        }

        // Update checklist display in real-time
        function updateChecklistDisplay(checklist) {
            const progressDiv = document.getElementById('checklistProgress');

            let html = '<div class="space-y-2">';
            checklist.forEach(item => {
                const statusIcon = {
                    'pending': '‚è≥',
                    'in-progress': 'üîÑ',
                    'completed': '‚úÖ',
                    'failed': '‚ùå'
                }[item.status];

                html += `
                    <div class="checklist-item ${item.status}">
                        <div class="flex items-center justify-between">
                            <span>${statusIcon} ${item.task}</span>
                            <small class="text-gray-500">${item.timestamp ? new Date(item.timestamp).toLocaleTimeString() : ''}</small>
                        </div>
                    </div>
                `;
            });
            html += '</div>';

            progressDiv.innerHTML = html;
        }

        // Update embedded report display
        function updateEmbeddedReport(reportData) {
            const reportDiv = document.getElementById('embeddedReport');

            let html = `
                <div class="space-y-6">
                    <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                        <h3 class="font-semibold text-green-800 text-lg">‚úÖ Automated Audit Completed</h3>
                        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                            <div>
                                <strong>Company:</strong> ${reportData.customer.companyName}<br>
                                <strong>Website:</strong> ${reportData.customer.website}
                            </div>
                            <div>
                                <strong>Folder Created:</strong> ${reportData.folderPath}<br>
                                <strong>Data Points:</strong> ${reportData.dataPointsCollected}
                            </div>
                            <div>
                                <strong>Completed:</strong> ${new Date().toLocaleString()}<br>
                                <strong>Report Sections:</strong> ${reportData.embeddedCSVSections}
                            </div>
                        </div>
                    </div>
            `;

            // Add all embedded CSV data sections
            if (reportData.csvData) {
                Object.entries(reportData.csvData).forEach(([key, htmlTable]) => {
                    html += htmlTable;
                });
            }

            html += '</div>';
            reportDiv.innerHTML = html;
        }

        // Make functions available globally for the automated system to call
        window.updateChecklistDisplay = updateChecklistDisplay;
        window.updateEmbeddedReport = updateEmbeddedReport;
    </script>
</body>
</html>