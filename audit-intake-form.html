<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Customer Audit - Intake Form</title>
    <meta name="description" content="Professional website audit intake form - SEO analysis, competitor research, and keyword strategy planning">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Automation Scripts -->
    <script src="seo-report-generator.js"></script>
    <script src="seo-audit-processor.js"></script>
    <script src="scripts/create-seo-audit.js"></script>
    <script src="audit-automation-hub.js"></script>
    <script src="customer-manager.js"></script>
    <script src="customer-report-generator.js"></script>
    <script src="real-audit-processor.js"></script>
    <script src="customer-audit-data-manager.js"></script>
    <script src="comprehensive-audit-data-collector.js"></script>
    <script src="automated-audit-system.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìã</text></svg>">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .form-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .card-shadow {
            box-shadow: 0 20px 40px -5px rgba(0, 0, 0, 0.2), 0 10px 20px -5px rgba(0, 0, 0, 0.1);
        }
        
        .input-field {
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
        }
        
        .input-field:focus {
            border-color: #3b82f6;
            ring: 0;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .step-indicator {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        
        .step-active {
            background: #3b82f6;
            color: white;
        }
        
        .step-complete {
            background: #10b981;
            color: white;
        }
        
        .step-pending {
            background: #e5e7eb;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <!-- Navigation -->
        <div class="text-center mb-6">
            <div class="flex justify-center gap-4 text-white/80 text-sm">
                <a href="index.html" class="hover:text-white transition-colors">‚Üê Portfolio</a>
                <span>|</span>
                <a href="customers-dashboard.html" class="hover:text-white transition-colors">üë• Customers</a>
            </div>
        </div>
        
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-4">üöÄ New Customer Audit</h1>
            <p class="text-xl text-white/90">Complete Website Analysis & Competitor Research</p>
            
            <!-- Process Overview -->
            <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 mt-8">
                <h3 class="text-white font-semibold mb-4">3-Stage Audit Process</h3>
                <div class="flex justify-center items-center space-x-4">
                    <div class="flex flex-col items-center">
                        <div class="step-indicator step-pending">1</div>
                        <span class="text-white/80 text-sm mt-2">SEO Audit</span>
                    </div>
                    <div class="text-white/60">‚Üí</div>
                    <div class="flex flex-col items-center">
                        <div class="step-indicator step-pending">2</div>
                        <span class="text-white/80 text-sm mt-2">Competitor Analysis</span>
                    </div>
                    <div class="text-white/60">‚Üí</div>
                    <div class="flex flex-col items-center">
                        <div class="step-indicator step-pending">3</div>
                        <span class="text-white/80 text-sm mt-2">Keyword Strategy</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Form -->
        <div class="bg-white rounded-2xl card-shadow p-8">
            <form id="auditIntakeForm">
                <!-- Customer Information Section -->
                <div class="mb-10">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        üë§ Customer Information
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2" for="customerName">
                                Customer/Company Name *
                            </label>
                            <input type="text" id="customerName" name="customerName" required
                                   class="w-full px-4 py-3 border rounded-lg input-field focus:outline-none"
                                   placeholder="e.g., IntelliMinds, TechCorp">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2" for="contactEmail">
                                Contact Email *
                            </label>
                            <input type="email" id="contactEmail" name="contactEmail" required
                                   class="w-full px-4 py-3 border rounded-lg input-field focus:outline-none"
                                   placeholder="client@company.com">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2" for="industry">
                                Industry/Business Type *
                            </label>
                            <select id="industry" name="industry" required
                                    class="w-full px-4 py-3 border rounded-lg input-field focus:outline-none">
                                <option value="">Select Industry</option>
                                <option value="Technology">Technology/Software</option>
                                <option value="E-commerce">E-commerce/Retail</option>
                                <option value="Healthcare">Healthcare</option>
                                <option value="Finance">Finance/Banking</option>
                                <option value="Real Estate">Real Estate</option>
                                <option value="Legal">Legal Services</option>
                                <option value="Education">Education</option>
                                <option value="Manufacturing">Manufacturing</option>
                                <option value="Consulting">Consulting</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2" for="location">
                                Primary Location/Market
                            </label>
                            <input type="text" id="location" name="location"
                                   class="w-full px-4 py-3 border rounded-lg input-field focus:outline-none"
                                   placeholder="e.g., Cape Town, South Africa">
                        </div>
                    </div>
                </div>

                <!-- Website Information Section -->
                <div class="mb-10">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        üåê Website Information
                    </h2>
                    
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2" for="primaryDomain">
                                Primary Website/Domain *
                            </label>
                            <input type="url" id="primaryDomain" name="primaryDomain" required
                                   class="w-full px-4 py-3 border rounded-lg input-field focus:outline-none"
                                   placeholder="https://www.example.com">
                            <p class="text-sm text-gray-600 mt-1">Include full URL with https://</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2" for="additionalPages">
                                Important Pages to Analyze (Optional)
                            </label>
                            <textarea id="additionalPages" name="additionalPages" rows="3"
                                      class="w-full px-4 py-3 border rounded-lg input-field focus:outline-none"
                                      placeholder="Enter additional important URLs, one per line:
https://www.example.com/services
https://www.example.com/about
https://www.example.com/products"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Competitor Analysis Section -->
                <div class="mb-10">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        üéØ Competitor Analysis
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2" for="competitor1">
                                Competitor 1 Website *
                            </label>
                            <input type="url" id="competitor1" name="competitor1" required
                                   class="w-full px-4 py-3 border rounded-lg input-field focus:outline-none"
                                   placeholder="https://www.competitor1.com">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2" for="competitor2">
                                Competitor 2 Website *
                            </label>
                            <input type="url" id="competitor2" name="competitor2" required
                                   class="w-full px-4 py-3 border rounded-lg input-field focus:outline-none"
                                   placeholder="https://www.competitor2.com">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2" for="competitor3">
                                Competitor 3 Website *
                            </label>
                            <input type="url" id="competitor3" name="competitor3" required
                                   class="w-full px-4 py-3 border rounded-lg input-field focus:outline-none"
                                   placeholder="https://www.competitor3.com">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2" for="competitor4">
                                Competitor 4 Website (Optional)
                            </label>
                            <input type="url" id="competitor4" name="competitor4"
                                   class="w-full px-4 py-3 border rounded-lg input-field focus:outline-none"
                                   placeholder="https://www.competitor4.com">
                        </div>
                    </div>
                </div>

                <!-- Keyword Strategy Section -->
                <div class="mb-10">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        üîç Keyword Strategy
                    </h2>
                    
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2" for="targetKeywords">
                                Target Keywords (Optional)
                            </label>
                            <textarea id="targetKeywords" name="targetKeywords" rows="3"
                                      class="w-full px-4 py-3 border rounded-lg input-field focus:outline-none"
                                      placeholder="Enter target keywords, one per line:
digital marketing
SEO services
website optimization"></textarea>
                            <p class="text-sm text-gray-600 mt-1">Leave blank to discover keywords through analysis</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2" for="geoTarget">
                                    Geographic Target
                                </label>
                                <input type="text" id="geoTarget" name="geoTarget"
                                       class="w-full px-4 py-3 border rounded-lg input-field focus:outline-none"
                                       placeholder="e.g., South Africa, Cape Town">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2" for="language">
                                    Primary Language
                                </label>
                                <select id="language" name="language"
                                        class="w-full px-4 py-3 border rounded-lg input-field focus:outline-none">
                                    <option value="en">English</option>
                                    <option value="af">Afrikaans</option>
                                    <option value="es">Spanish</option>
                                    <option value="fr">French</option>
                                    <option value="de">German</option>
                                    <option value="pt">Portuguese</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Business Goals Section -->
                <div class="mb-10">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        üéØ Business Goals
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                Primary Objectives (Select all that apply)
                            </label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="flex items-center">
                                    <input type="checkbox" name="objectives" value="increase_traffic" class="mr-3">
                                    <span>Increase organic traffic</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="objectives" value="improve_rankings" class="mr-3">
                                    <span>Improve search rankings</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="objectives" value="beat_competitors" class="mr-3">
                                    <span>Outrank competitors</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="objectives" value="local_visibility" class="mr-3">
                                    <span>Local search visibility</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="objectives" value="content_strategy" class="mr-3">
                                    <span>Content strategy</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="objectives" value="technical_seo" class="mr-3">
                                    <span>Technical SEO improvements</span>
                                </label>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2" for="additionalNotes">
                                Additional Notes/Requirements
                            </label>
                            <textarea id="additionalNotes" name="additionalNotes" rows="4"
                                      class="w-full px-4 py-3 border rounded-lg input-field focus:outline-none"
                                      placeholder="Any additional context, specific requirements, or goals for this audit..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200">
                    <button type="button" onclick="saveDraft()" 
                            class="flex-1 bg-gray-600 text-white py-4 px-6 rounded-lg font-semibold hover:bg-gray-700 transition-colors">
                        üíæ Save Draft
                    </button>
                    <button type="submit" 
                            class="flex-2 bg-blue-600 text-white py-4 px-8 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                        üöÄ Start Comprehensive Audit
                    </button>
                </div>
            </form>
        </div>

        <!-- Footer -->
        <div class="text-center mt-8 text-white/80">
            <p>¬© 2025 Professional Website Audits - Comprehensive SEO & Competitor Analysis</p>
        </div>
    </div>

    <script>
        // Form handling and validation
        document.getElementById('auditIntakeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('üöÄ Form submitted!');

            // Show loading state
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '‚è≥ Processing...';
            submitBtn.disabled = true;

            // Immediate feedback for debugging
            showSuccess('Form submitted! Processing...');
            
            // Collect form data
            const formData = new FormData(e.target);
            const auditData = {};
            
            for (let [key, value] of formData.entries()) {
                if (auditData[key]) {
                    if (Array.isArray(auditData[key])) {
                        auditData[key].push(value);
                    } else {
                        auditData[key] = [auditData[key], value];
                    }
                } else {
                    auditData[key] = value;
                }
            }
            
            // Generate customer folder name
            const customerName = auditData.customerName.toLowerCase()
                                    .replace(/[^a-z0-9]/g, '-')
                                    .replace(/-+/g, '-')
                                    .replace(/^-|-$/g, '');
            
            auditData.customerFolder = customerName;
            auditData.timestamp = new Date().toISOString();
            
            // Process the audit request
            processAuditRequest(auditData).then((result) => {
                if (result && result.success) {
                    // Clear loading state first
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;

                    // Show immediate success notification
                    showSuccess(`‚úÖ Customer "${auditData.customerName}" added successfully! Real audit processing started.`);

                    // Show detailed success dialog
                    setTimeout(() => {
                        const message = `üéâ SUCCESS!\n\nCustomer: ${auditData.customerName}\nEmail: ${auditData.contactEmail}\nWebsite: ${auditData.primaryDomain}\n\n‚úÖ Real audit processing has started!\nüìä View live progress on dashboard\n\nClick OK to go to Dashboard\nClick Cancel to create another audit`;
                        const goToDashboard = confirm(message);
                        if (goToDashboard) {
                            window.location.href = 'customers-dashboard.html';
                        } else {
                            // Clear form for new entry
                            e.target.reset();
                            clearDraft(); // Clear saved draft too
                        }
                    }, 800);
                } else {
                    console.warn('‚ö†Ô∏è Customer Manager returned no success result:', result);

                    // Clear loading state
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;

                    showSuccess('Customer data saved. Processing audit in background...');
                    setTimeout(() => {
                        const continueActions = confirm('Customer data saved!\n\nClick OK to view Dashboard\nClick Cancel to submit another audit');
                        if (continueActions) {
                            window.location.href = 'customers-dashboard.html';
                        } else {
                            e.target.reset();
                            clearDraft();
                        }
                    }, 800);
                }

            }).catch(error => {
                console.error('Form submission error:', error);

                // Clear loading state
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;

                // Show error with fallback success
                showError(`Error: ${error.message}`);

                // Fallback success after 2 seconds
                setTimeout(() => {
                    showSuccess('‚ö†Ô∏è Form data saved locally. Customer will be processed when system is ready.');
                    setTimeout(() => {
                        const goToDashboard = confirm('Form submitted successfully!\n\nClick OK to view Dashboard\nClick Cancel to stay on form');
                        if (goToDashboard) {
                            window.location.href = 'customers-dashboard.html';
                        }
                    }, 1000);
                }, 2000);
            });
        });
        
        async function processAuditRequest(data) {
            console.log('üîÑ Processing audit request:', data);

            // Store audit data in localStorage
            const auditId = 'audit_' + Date.now();
            localStorage.setItem(auditId, JSON.stringify(data));

            // Check if required modules are loaded
            if (!window.customerManager) {
                console.error('‚ùå Customer Manager not loaded');
                // Show immediate error feedback
                setTimeout(() => {
                    showError('Customer management system not ready. Please refresh the page and try again.');
                }, 100);
                throw new Error('Customer management system not ready. Please refresh and try again.');
            }

            console.log('‚úÖ Customer Manager ready:', typeof window.customerManager);

            try {
                // Format data for customer manager
                const customerData = {
                    companyName: data.customerName || 'Unknown Company',
                    contactName: (data.contactEmail || '').split('@')[0] || 'Contact',
                    email: data.contactEmail || '',
                    phone: data.phone || '',
                    website: data.primaryDomain || '',
                    industry: data.industry || '',
                    location: data.location || '',
                    competitors: [data.competitor1, data.competitor2, data.competitor3, data.competitor4].filter(Boolean),
                    targetKeywords: data.targetKeywords ? data.targetKeywords.split(/[,\n]/).map(k => k.trim()).filter(Boolean) : []
                };

                console.log('üìã Customer data formatted:', customerData);

                // Create customer project
                const customer = await window.customerManager.createCustomerProject(customerData);
                console.log('‚úÖ Customer project created:', customer);

                // Store the customer ID for reference
                data.customerId = customer.id;
                data.reportUrl = customer.reportUrl;

                return { success: true, customer: customer };

            } catch (error) {
                console.error('‚ùå Error creating customer project:', error);
                // Don't throw error, continue with fallback CRM
                console.log('‚ö†Ô∏è Falling back to basic CRM storage...');
            }

            // Process customer through automation hub
            if (typeof window.processIntakeForm === 'function') {
                const automationResult = await window.processIntakeForm(data);
                if (automationResult.success) {
                    console.log('‚úÖ Customer processed through automation:', automationResult);
                } else {
                    console.warn('‚ö†Ô∏è Automation failed, using fallback CRM:', automationResult.error);
                    addCustomerToCRM(data);
                }
            } else {
                // Fallback: Add customer to CRM manually
                addCustomerToCRM(data);
            }

            console.log('Audit request processed:', data);

            // Simulate processing time
            await new Promise(resolve => setTimeout(resolve, 2000));

            return { auditId, customerFolder: data.customerFolder, customerId: data.customerId, reportUrl: data.reportUrl };
        }
        
        function addCustomerToCRM(auditData) {
            // Load existing CRM data
            let crmCustomers = [];
            const existingData = localStorage.getItem('crm_customers');
            if (existingData) {
                crmCustomers = JSON.parse(existingData);
            }
            
            // Check if customer already exists
            const existingCustomer = crmCustomers.find(c => 
                c.primaryDomain === auditData.primaryDomain || 
                c.contactEmail === auditData.contactEmail
            );
            
            if (existingCustomer) {
                // Update existing customer with new audit request
                existingCustomer.lastUpdate = new Date().toISOString().split('T')[0];
                existingCustomer.status = 'active';
                existingCustomer.notes = (existingCustomer.notes || '') + '\n\nNew audit request: ' + new Date().toLocaleDateString();
                
                // Update competitors and keywords if provided
                if (auditData.competitor1) existingCustomer.competitors = [auditData.competitor1, auditData.competitor2, auditData.competitor3, auditData.competitor4].filter(Boolean);
                if (auditData.targetKeywords) existingCustomer.targetKeywords = auditData.targetKeywords.split('\n').filter(Boolean);
                if (auditData.objectives) existingCustomer.objectives = Array.isArray(auditData.objectives) ? auditData.objectives : [auditData.objectives];
            } else {
                // Create new customer record
                const newCustomer = {
                    id: auditData.customerFolder,
                    customerName: auditData.customerName,
                    contactEmail: auditData.contactEmail,
                    primaryDomain: auditData.primaryDomain,
                    industry: auditData.industry,
                    location: auditData.location,
                    status: 'active',
                    seoScore: 0,
                    progress: {
                        seoAudit: 0,
                        competitorAnalysis: 0,
                        keywordStrategy: 0
                    },
                    dateAdded: new Date().toISOString().split('T')[0],
                    lastUpdate: new Date().toISOString().split('T')[0],
                    notes: auditData.additionalNotes || 'Customer added via audit intake form',
                    auditHistory: [],
                    competitors: [auditData.competitor1, auditData.competitor2, auditData.competitor3, auditData.competitor4].filter(Boolean),
                    targetKeywords: auditData.targetKeywords ? auditData.targetKeywords.split('\n').filter(Boolean) : [],
                    objectives: Array.isArray(auditData.objectives) ? auditData.objectives : [auditData.objectives].filter(Boolean),
                    geoTarget: auditData.geoTarget,
                    language: auditData.language,
                    additionalPages: auditData.additionalPages ? auditData.additionalPages.split('\n').filter(Boolean) : []
                };
                
                crmCustomers.push(newCustomer);
            }
            
            // Save updated CRM data
            localStorage.setItem('crm_customers', JSON.stringify(crmCustomers));
        }
        
        function saveDraft() {
            const formData = new FormData(document.getElementById('auditIntakeForm'));
            const draftData = {};
            
            for (let [key, value] of formData.entries()) {
                draftData[key] = value;
            }
            
            localStorage.setItem('audit_draft', JSON.stringify(draftData));
            showSuccess('Draft saved successfully! You can return to complete it later.');
        }
        
        function loadDraft() {
            const draft = localStorage.getItem('audit_draft');
            if (draft) {
                const data = JSON.parse(draft);
                for (let [key, value] of Object.entries(data)) {
                    const field = document.querySelector(`[name="${key}"]`);
                    if (field) {
                        field.value = value;
                    }
                }
            }
        }
        
        function showSuccess(message) {
            showNotification(message, 'success');
        }
        
        function showError(message) {
            showNotification(message, 'error');
        }
        
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-4 rounded-lg font-semibold z-50 transition-all transform translate-x-full max-w-md`;
            notification.className += type === 'success' ? ' bg-green-600 text-white' : ' bg-red-600 text-white';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }
        
        // Load draft on page load
        window.addEventListener('load', function() {
            loadDraft();

            // System status check
            setTimeout(() => {
                console.log('üìä System Status Check:');
                console.log('Customer Manager:', !!window.customerManager);
                console.log('Report Generator:', !!window.customerReportGenerator);
                console.log('Audit Processor:', !!window.realAuditProcessor);
                console.log('Audit Data Manager:', !!window.customerAuditDataManager);
                console.log('Comprehensive Collector:', !!window.comprehensiveAuditDataCollector);
                console.log('Automated Audit System:', !!window.automatedAuditSystem);

                if (!window.customerManager) {
                    console.warn('‚ö†Ô∏è Customer Manager not loaded - this may cause form submission issues');
                }

                // Initialize automated audit system if available
                if (window.automatedAuditSystem) {
                    console.log('‚úÖ Automated Audit System is running and monitoring for new customers');
                } else {
                    console.warn('‚ö†Ô∏è Automated Audit System not loaded - background processing may not work');
                }
            }, 2000);
        });
        
        // Auto-save draft every 30 seconds
        setInterval(() => {
            const formData = new FormData(document.getElementById('auditIntakeForm'));
            if (formData.get('customerName') || formData.get('primaryDomain')) {
                saveDraft();
            }
        }, 30000);
        
        // URL validation
        document.querySelectorAll('input[type="url"]').forEach(input => {
            input.addEventListener('blur', function() {
                if (this.value && !this.value.match(/^https?:\/\//)) {
                    this.value = 'https://' + this.value;
                }
            });
        });
    </script>
</body>
</html>